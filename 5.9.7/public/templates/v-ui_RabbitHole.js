"use strict";

System.register(["jquery", "/js/common/util.js"], function (_export, _context) {
  "use strict";

  var $, CommonUtil, pre, html;
  return {
    setters: [function (_jquery) {
      $ = _jquery.default;
    }, function (_jsCommonUtilJs) {
      CommonUtil = _jsCommonUtilJs.default;
    }],
    execute: function () {
      _export("pre", pre = function pre(individual, template, container, mode, extra) {
        template = $(template);
        container = $(container);
        var defaultProperties = 'v-s:backwardTarget v-s:parent';
        var allowedProperties = (container.data('properties') || defaultProperties).split(' ');
        var name = mkName(individual);
        var visited;
        var _loop = function _loop() {
          if (individual.hasValue(property)) {
            var temp = $('h5', template);
            individual[property].forEach(function (prop) {
              var text = "<span title='" + name.title + "'>" + name.label + '</span>';
              visited = [individual.id];
              var wrapper = temp.clone();
              travel(prop, text).then(function (rText) {
                $('small', wrapper).append(rText);
                template.append(wrapper);
              });
            });
            return "break";
          }
        };
        for (var i = 0, property; property = allowedProperties[i]; i++) {
          var _ret = _loop();
          if (_ret === "break") break;
        }
        function travel(individual, text) {
          if (visited.indexOf(individual.id) >= 0) {
            return Promise.resolve(text);
          } else {
            visited.push(individual.id);
          }
          return individual.load().then(function () {
            var name = mkName(individual);
            text = "<a href='#/" + individual.id + "' title='" + name.title + "'>" + name.label + '</a>' + ' / ' + text;
            for (var _i = 0, _property; _property = allowedProperties[_i]; _i++) {
              if (individual.hasValue(_property)) {
                return travel(individual[_property][0], text);
                // break;
              }
            }

            return text;
          }).catch(function (error) {
            var errorIndividual = new IndividualModel("v-s:Error_".concat(error.code));
            return errorIndividual.load().then(function (errorIndividual) {
              return "<span>".concat(errorIndividual['v-s:errorMessage'].map(CommonUtil.formatValue).join(' '), "</span> / ").concat(text);
            });
          });
        }
        function mkName(individual) {
          var label = individual['rdf:type'][0].toString() + ': ' + individual.toString();
          var title = label;
          var re = new RegExp('.*?:');
          if (label.length > 70) {
            label = label.replace(re, function (typeName) {
              return typeName.split(' ').reduce(function (abbr, word) {
                return abbr += word.charAt(0);
              }, '').toUpperCase() + ':';
            });
            label = label.substring(0, 70) + '...';
          }
          return {
            title: title,
            label: label
          };
        }
      });
      _export("html", html = "\n  <div>\n    <h5><small></small></h5>\n  </div>\n");
    }
  };
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyIkIiwiX2pxdWVyeSIsImRlZmF1bHQiLCJfanNDb21tb25VdGlsSnMiLCJDb21tb25VdGlsIiwiZXhlY3V0ZSIsIl9leHBvcnQiLCJwcmUiLCJpbmRpdmlkdWFsIiwidGVtcGxhdGUiLCJjb250YWluZXIiLCJtb2RlIiwiZXh0cmEiLCJkZWZhdWx0UHJvcGVydGllcyIsImFsbG93ZWRQcm9wZXJ0aWVzIiwiZGF0YSIsInNwbGl0IiwibmFtZSIsIm1rTmFtZSIsInZpc2l0ZWQiLCJfbG9vcCIsImhhc1ZhbHVlIiwicHJvcGVydHkiLCJ0ZW1wIiwiZm9yRWFjaCIsInByb3AiLCJ0ZXh0IiwidGl0bGUiLCJsYWJlbCIsImlkIiwid3JhcHBlciIsImNsb25lIiwidHJhdmVsIiwidGhlbiIsInJUZXh0IiwiYXBwZW5kIiwiaSIsIl9yZXQiLCJpbmRleE9mIiwiUHJvbWlzZSIsInJlc29sdmUiLCJwdXNoIiwibG9hZCIsImNhdGNoIiwiZXJyb3IiLCJlcnJvckluZGl2aWR1YWwiLCJJbmRpdmlkdWFsTW9kZWwiLCJjb25jYXQiLCJjb2RlIiwibWFwIiwiZm9ybWF0VmFsdWUiLCJqb2luIiwidG9TdHJpbmciLCJyZSIsIlJlZ0V4cCIsImxlbmd0aCIsInJlcGxhY2UiLCJ0eXBlTmFtZSIsInJlZHVjZSIsImFiYnIiLCJ3b3JkIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzdWJzdHJpbmciLCJodG1sIl0sInNvdXJjZXMiOlsiLi4vLi4vb250b2xvZ3kvc3lzdGVtLWNvcmUvdGVtcGxhdGVzL3YtdWlfUmFiYml0SG9sZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJCBmcm9tICdqcXVlcnknO1xuaW1wb3J0IENvbW1vblV0aWwgZnJvbSAnL2pzL2NvbW1vbi91dGlsLmpzJztcblxuZXhwb3J0IGNvbnN0IHByZSA9IGZ1bmN0aW9uIChpbmRpdmlkdWFsLCB0ZW1wbGF0ZSwgY29udGFpbmVyLCBtb2RlLCBleHRyYSkge1xuICB0ZW1wbGF0ZSA9ICQodGVtcGxhdGUpO1xuICBjb250YWluZXIgPSAkKGNvbnRhaW5lcik7XG5cbiAgY29uc3QgZGVmYXVsdFByb3BlcnRpZXMgPSAndi1zOmJhY2t3YXJkVGFyZ2V0IHYtczpwYXJlbnQnO1xuICBjb25zdCBhbGxvd2VkUHJvcGVydGllcyA9IChjb250YWluZXIuZGF0YSgncHJvcGVydGllcycpIHx8IGRlZmF1bHRQcm9wZXJ0aWVzKS5zcGxpdCgnICcpO1xuICBjb25zdCBuYW1lID0gbWtOYW1lKGluZGl2aWR1YWwpO1xuICBsZXQgdmlzaXRlZDtcbiAgZm9yIChsZXQgaSA9IDAsIHByb3BlcnR5OyAocHJvcGVydHkgPSBhbGxvd2VkUHJvcGVydGllc1tpXSk7IGkrKykge1xuICAgIGlmIChpbmRpdmlkdWFsLmhhc1ZhbHVlKHByb3BlcnR5KSkge1xuICAgICAgY29uc3QgdGVtcCA9ICQoJ2g1JywgdGVtcGxhdGUpO1xuICAgICAgaW5kaXZpZHVhbFtwcm9wZXJ0eV0uZm9yRWFjaChmdW5jdGlvbiAocHJvcCkge1xuICAgICAgICBjb25zdCB0ZXh0ID0gXCI8c3BhbiB0aXRsZT0nXCIgKyBuYW1lLnRpdGxlICsgXCInPlwiICsgbmFtZS5sYWJlbCArICc8L3NwYW4+JztcbiAgICAgICAgdmlzaXRlZCA9IFtpbmRpdmlkdWFsLmlkXTtcbiAgICAgICAgY29uc3Qgd3JhcHBlciA9IHRlbXAuY2xvbmUoKTtcbiAgICAgICAgdHJhdmVsKHByb3AsIHRleHQpLnRoZW4oZnVuY3Rpb24gKHJUZXh0KSB7XG4gICAgICAgICAgJCgnc21hbGwnLCB3cmFwcGVyKS5hcHBlbmQoclRleHQpO1xuICAgICAgICAgIHRlbXBsYXRlLmFwcGVuZCh3cmFwcGVyKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHRyYXZlbCAoaW5kaXZpZHVhbCwgdGV4dCkge1xuICAgIGlmICh2aXNpdGVkLmluZGV4T2YoaW5kaXZpZHVhbC5pZCkgPj0gMCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0ZXh0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmlzaXRlZC5wdXNoKGluZGl2aWR1YWwuaWQpO1xuICAgIH1cbiAgICByZXR1cm4gaW5kaXZpZHVhbFxuICAgICAgLmxvYWQoKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBuYW1lID0gbWtOYW1lKGluZGl2aWR1YWwpO1xuICAgICAgICB0ZXh0ID0gXCI8YSBocmVmPScjL1wiICsgaW5kaXZpZHVhbC5pZCArIFwiJyB0aXRsZT0nXCIgKyBuYW1lLnRpdGxlICsgXCInPlwiICsgbmFtZS5sYWJlbCArICc8L2E+JyArICcgLyAnICsgdGV4dDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIHByb3BlcnR5OyAocHJvcGVydHkgPSBhbGxvd2VkUHJvcGVydGllc1tpXSk7IGkrKykge1xuICAgICAgICAgIGlmIChpbmRpdmlkdWFsLmhhc1ZhbHVlKHByb3BlcnR5KSkge1xuICAgICAgICAgICAgcmV0dXJuIHRyYXZlbChpbmRpdmlkdWFsW3Byb3BlcnR5XVswXSwgdGV4dCk7XG4gICAgICAgICAgICAvLyBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRleHQ7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICBjb25zdCBlcnJvckluZGl2aWR1YWwgPSBuZXcgSW5kaXZpZHVhbE1vZGVsKGB2LXM6RXJyb3JfJHtlcnJvci5jb2RlfWApO1xuICAgICAgICByZXR1cm4gZXJyb3JJbmRpdmlkdWFsLmxvYWQoKS50aGVuKGZ1bmN0aW9uIChlcnJvckluZGl2aWR1YWwpIHtcbiAgICAgICAgICByZXR1cm4gYDxzcGFuPiR7ZXJyb3JJbmRpdmlkdWFsWyd2LXM6ZXJyb3JNZXNzYWdlJ10ubWFwKENvbW1vblV0aWwuZm9ybWF0VmFsdWUpLmpvaW4oJyAnKX08L3NwYW4+IC8gJHt0ZXh0fWA7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gbWtOYW1lIChpbmRpdmlkdWFsKSB7XG4gICAgbGV0IGxhYmVsID0gaW5kaXZpZHVhbFsncmRmOnR5cGUnXVswXS50b1N0cmluZygpICsgJzogJyArIGluZGl2aWR1YWwudG9TdHJpbmcoKTtcbiAgICBjb25zdCB0aXRsZSA9IGxhYmVsO1xuICAgIGNvbnN0IHJlID0gbmV3IFJlZ0V4cCgnLio/OicpO1xuICAgIGlmIChsYWJlbC5sZW5ndGggPiA3MCkge1xuICAgICAgbGFiZWwgPSBsYWJlbC5yZXBsYWNlKHJlLCBmdW5jdGlvbiAodHlwZU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICB0eXBlTmFtZVxuICAgICAgICAgICAgLnNwbGl0KCcgJylcbiAgICAgICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKGFiYnIsIHdvcmQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIChhYmJyICs9IHdvcmQuY2hhckF0KDApKTtcbiAgICAgICAgICAgIH0sICcnKVxuICAgICAgICAgICAgLnRvVXBwZXJDYXNlKCkgKyAnOidcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgICAgbGFiZWwgPSBsYWJlbC5zdWJzdHJpbmcoMCwgNzApICsgJy4uLic7XG4gICAgfVxuICAgIHJldHVybiB7dGl0bGU6IHRpdGxlLCBsYWJlbDogbGFiZWx9O1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgaHRtbCA9IGBcbiAgPGRpdj5cbiAgICA8aDU+PHNtYWxsPjwvc21hbGw+PC9oNT5cbiAgPC9kaXY+XG5gO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztNQUFPQSxDQUFDLEdBQUFDLE9BQUEsQ0FBQUMsT0FBQTtJQUFBLGFBQUFDLGVBQUE7TUFDREMsVUFBVSxHQUFBRCxlQUFBLENBQUFELE9BQUE7SUFBQTtJQUFBRyxPQUFBLFdBQUFBLENBQUE7TUFBQUMsT0FBQSxRQUVKQyxHQUFHLEdBQUcsU0FBTkEsR0FBR0EsQ0FBYUMsVUFBVSxFQUFFQyxRQUFRLEVBQUVDLFNBQVMs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